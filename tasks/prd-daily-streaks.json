{
  "project": "ace-prep",
  "feature": "daily-streaks",
  "branchName": "ralph/daily-streaks",
  "description": "Track consecutive days of study activity with streak counter displayed on dashboard and nav",
  "userStories": [
    {
      "id": "US-001",
      "title": "Shared Streak Types",
      "description": "As a developer, I need TypeScript types for streak data so frontend and backend share contracts.",
      "acceptanceCriteria": [
        "UserStreak type with currentStreak, longestStreak, lastActivityDate",
        "StreakMilestone type for milestone definitions",
        "Export from @ace-prep/shared",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Database Schema for Streaks",
      "description": "As a developer, I need a database table to persist user streak data.",
      "acceptanceCriteria": [
        "userStreaks table with: id, userId, currentStreak, longestStreak, lastActivityDate, updatedAt",
        "Unique index on userId",
        "Foreign key to users table with cascade delete",
        "Migration file created",
        "npm run db:migrate succeeds",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Streak Service Logic",
      "description": "As a developer, I need a service to calculate and update streaks when activities occur.",
      "acceptanceCriteria": [
        "updateStreak(userId: number) function in services/streakService.ts",
        "Creates streak record if not exists (initializes to 1)",
        "Increments streak if last activity was yesterday",
        "Resets streak to 1 if last activity was 2+ days ago",
        "Maintains streak if activity already recorded today",
        "Updates longestStreak when currentStreak exceeds it",
        "Returns updated streak data and whether milestone was hit",
        "Uses date-only comparison (YYYY-MM-DD) for timezone safety",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Streak API Endpoint",
      "description": "As a user, I need an API endpoint to fetch my current streak data.",
      "acceptanceCriteria": [
        "GET /api/progress/streak returns UserStreak data",
        "Returns { currentStreak: 0, longestStreak: 0, lastActivityDate: null } if no record",
        "Requires authentication",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Trigger Streak Update on Exam Completion",
      "description": "As a user, when I complete an exam my streak should update.",
      "acceptanceCriteria": [
        "PATCH /api/exams/:id/complete calls updateStreak(userId)",
        "Streak updated within same transaction",
        "Response includes streakUpdate?: { current: number, milestone?: number }",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Trigger Streak Update on Study Session Completion",
      "description": "As a user, when I complete a study session my streak should update.",
      "acceptanceCriteria": [
        "PATCH /api/study/sessions/:id/complete calls updateStreak(userId)",
        "Streak updated within same transaction",
        "Response includes streakUpdate?: { current: number, milestone?: number }",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Trigger Streak Update on Learning Path Completion",
      "description": "As a user, when I complete a learning path item my streak should update.",
      "acceptanceCriteria": [
        "PATCH /api/study/learning-path/:order/complete calls updateStreak(userId)",
        "Only triggers on completion (not on toggle-off)",
        "Response includes streakUpdate?: { current: number, milestone?: number }",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Trigger Streak Update on Spaced Repetition Review",
      "description": "As a user, when I complete a spaced repetition review my streak should update.",
      "acceptanceCriteria": [
        "POST /api/questions/review calls updateStreak(userId)",
        "Response includes streakUpdate?: { current: number, milestone?: number }",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Frontend API Client for Streaks",
      "description": "As a frontend developer, I need API client methods to fetch streak data.",
      "acceptanceCriteria": [
        "progressApi.getStreak() method returns Promise<UserStreak>",
        "Proper error handling",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Streak Display Component",
      "description": "As a user, I need a reusable component that displays my streak with a flame icon.",
      "acceptanceCriteria": [
        "StreakDisplay component shows flame icon + current streak number",
        "Shows ðŸ”¥ X days format",
        "Compact variant for nav bar (icon + number only)",
        "Full variant for dashboard (includes longest streak)",
        "Visual distinction when streak is 0 (gray/muted)",
        "CSS Module styling consistent with app",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Streak Widget on Dashboard",
      "description": "As a user, I want to see my streak prominently on the dashboard.",
      "acceptanceCriteria": [
        "Streak card in dashboard stats grid",
        "Shows current streak with flame icon",
        "Shows Longest: X days below",
        "Fetches via useQuery with ['streak'] key",
        "Loading state while fetching",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Streak Display in Navigation",
      "description": "As a user, I want to see my streak in the nav bar so it's always visible.",
      "acceptanceCriteria": [
        "Compact streak display in sidebar footer (desktop)",
        "Compact streak display in mobile nav header",
        "Updates when streak changes (query invalidation)",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Milestone Toast Notifications",
      "description": "As a user, when I hit a streak milestone I want to be celebrated with a toast.",
      "acceptanceCriteria": [
        "Milestones: 7, 30, 100, 365 days",
        "Toast shows: ðŸ”¥ {N}-Day Streak! with congratulatory message",
        "Toast auto-dismisses after 5 seconds",
        "Toast triggered when API response includes milestone",
        "Works on exam completion, study completion, learning path, SR review",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Query Invalidation on Streak Update",
      "description": "As a user, when my streak updates, all streak displays should refresh.",
      "acceptanceCriteria": [
        "Activity completion mutations invalidate ['streak'] query",
        "Dashboard and nav both update without page refresh",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    }
  ]
}
